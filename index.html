<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Photo Logger</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 600px; margin: auto; }
    input, textarea { width: 100%; margin-top: 10px; }
    button { margin-top: 10px; }
    img { max-width: 100px; margin: 10px 0; display: block; }
    .entry { border-bottom: 1px solid #ccc; padding: 10px 0; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h2>Photo Logger</h2>

<form id="entryForm">
  <label>Photo:</label><br>
  <input type="file" id="photo" accept="image/*" capture="environment" required><br>

  <label>Location:</label><br>
  <input type="text" id="location" placeholder="Enter location" required><br>

  <label>Description:</label><br>
  <textarea id="description" rows="3" placeholder="Enter description" required></textarea><br>

  <button type="submit">Add Entry</button>
</form>

<h3>Entries</h3>
<div id="entries"></div>

<button onclick="exportToPDF()">Export as PDF</button>

<script>
  let entries = [];
  let count = 1;

  document.getElementById('entryForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const photoInput = document.getElementById('photo');
    const location = document.getElementById('location').value;
    const description = document.getElementById('description').value;
    const file = photoInput.files[0];

    if (!file) return;

    const reader = new FileReader();
    reader.onload = function() {
      const imgData = reader.result;

      const entry = {
        number: count++,
        location,
        description,
        photo: imgData
      };

      entries.push(entry);
      displayEntries();

      // Reset form
      photoInput.value = "";
      document.getElementById('location').value = "";
      document.getElementById('description').value = "";
    };
    reader.readAsDataURL(file);
  });

  function displayEntries() {
    const container = document.getElementById('entries');
    container.innerHTML = "";

    entries.forEach(entry => {
      const div = document.createElement('div');
      div.className = 'entry';
      div.innerHTML = `
        <strong>#${entry.number}</strong><br>
        <img src="${entry.photo}" alt="Photo ${entry.number}"><br>
        <strong>Location:</strong> ${entry.location}<br>
        <strong>Description:</strong> ${entry.description}
      `;
      container.appendChild(div);
    });
  }

  async function exportToPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    for (let i = 0; i < entries.length; i++) {
      const entry = entries[i];
      const imgProps = await new Promise((resolve) => {
        const img = new Image();
        img.onload = function () {
          const ratio = img.width / img.height;
          const width = 50;
          const height = width / ratio;
          resolve({ img, width, height });
        };
        img.src = entry.photo;
      });

      if (i > 0) doc.addPage();

      doc.setFontSize(14);
      doc.text(`Entry #${entry.number}`, 10, 20);
      doc.addImage(imgProps.img, 'JPEG', 10, 30, imgProps.width, imgProps.height);
      let yOffset = 30 + imgProps.height + 10;

      doc.setFontSize(12);
      doc.text(`Location: ${entry.location}`, 10, yOffset);
      yOffset += 10;
      doc.text(`Description: ${entry.description}`, 10, yOffset);
    }

    const pdfBlob = doc.output('blob');

    if (navigator.canShare && navigator.canShare({ files: [new File([pdfBlob], 'photo_log.pdf', { type: 'application/pdf' })] })) {
      try {
        await navigator.share({
          files: [new File([pdfBlob], 'photo_log.pdf', { type: 'application/pdf' })],
          title: 'Photo Log',
          text: 'Here is your exported photo log PDF.'
        });
      } catch (err) {
        alert('Sharing failed: ' + err.message);
      }
    } else {
      // fallback for desktop browsers: download
      doc.save('photo_log.pdf');
    }
  }
</script>

</body>
</html>
